import{u as V,i as j,a as D,b as G,c as K,d as P,e as U,s as _}from"./index-DWTZmJt_.js";import{d as q,o as H,c as J,a,b as s,w as e,e as v,f as r,r as c,g as Q,h,t as d,l as W,n as A,u as f,p as y,E as z}from"./index-CeN3S9B-.js";import{i as X}from"./install-BKa6yPLF.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"memory"},tt={class:"stat-text"},et={class:"stat-grid"},ot={class:"stat-item"},at={class:"stat-num"},st={class:"stat-item"},lt={class:"stat-num"},nt={class:"stat-item"},rt={class:"stat-num"},it={class:"stat-item"},dt={class:"stat-num"},pt=q({__name:"Memory",setup(mt){V([j,X,D,G,K,P,U]);const b=c(0),w=c(0),B=c(0),x=c(!1),m=c(null),n=Q({recent_records:null,daily_stats:null,monthly_stats:null,last_opt_time:"",last_opt_ago:"",total_freed_mb:0,total_count:0}),C=o=>o<50?"#67c23a":o<80?"#e6a23c":"#f56c6c",M=o=>{if(o===0)return"0 B";const t=1024,l=["B","KB","MB","GB","TB"],u=Math.floor(Math.log(o)/Math.log(t));return parseFloat((o/Math.pow(t,u)).toFixed(1))+" "+l[u]},$=y(()=>{const o=n.recent_records||[],t=o.map(l=>l.date.slice(5)+" "+l.time.slice(0,5));return{tooltip:{trigger:"axis"},legend:{data:["释放(MB)","优化前%","优化后%"],bottom:0},grid:{left:50,right:20,top:16,bottom:40},xAxis:{type:"category",data:t,axisLabel:{fontSize:10,rotate:30}},yAxis:[{type:"value",name:"MB",position:"left"},{type:"value",name:"%",position:"right",max:100}],series:[{name:"释放(MB)",type:"bar",yAxisIndex:0,data:o.map(l=>+l.freed_mb.toFixed(1)),itemStyle:{color:"#67c23a",borderRadius:[4,4,0,0]}},{name:"优化前%",type:"line",yAxisIndex:1,smooth:!0,data:o.map(l=>+l.before_percent.toFixed(1)),lineStyle:{color:"#f56c6c",width:2},itemStyle:{color:"#f56c6c"}},{name:"优化后%",type:"line",yAxisIndex:1,smooth:!0,data:o.map(l=>+l.after_percent.toFixed(1)),lineStyle:{color:"#409eff",width:2},itemStyle:{color:"#409eff"}}]}}),k=y(()=>{const o=n.daily_stats||[];return{tooltip:{trigger:"axis"},grid:{left:50,right:10,top:16,bottom:30},xAxis:{type:"category",data:o.map(t=>t.date.slice(5)),axisLabel:{fontSize:10,rotate:30}},yAxis:{type:"value",name:"MB"},series:[{type:"bar",data:o.map(t=>+t.freed_mb.toFixed(1)),itemStyle:{borderRadius:[4,4,0,0],color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#67c23a"},{offset:1,color:"#b7eb8f"}]}}}]}}),I=y(()=>{const o=n.monthly_stats||[];return{tooltip:{trigger:"axis"},legend:{data:["释放(MB)","次数"],bottom:0},grid:{left:50,right:40,top:16,bottom:40},xAxis:{type:"category",data:o.map(t=>t.month)},yAxis:[{type:"value",name:"MB",position:"left"},{type:"value",name:"次",position:"right"}],series:[{name:"释放(MB)",type:"bar",yAxisIndex:0,data:o.map(t=>+t.freed_mb.toFixed(1)),itemStyle:{color:"#409eff",borderRadius:[4,4,0,0]}},{name:"次数",type:"line",yAxisIndex:1,smooth:!0,data:o.map(t=>t.count),lineStyle:{color:"#e6a23c",width:2},itemStyle:{color:"#e6a23c"}}]}}),O=y(()=>{const o=(n.recent_records||[]).slice(-5),t=o.map(l=>l.date.slice(5)+`
`+l.time.slice(0,5));return{tooltip:{trigger:"axis"},legend:{data:["优化前","优化后"],bottom:0},grid:{left:40,right:10,top:16,bottom:40},xAxis:{type:"category",data:t,axisLabel:{fontSize:10}},yAxis:{type:"value",name:"%",max:100},series:[{name:"优化前",type:"bar",data:o.map(l=>+l.before_percent.toFixed(1)),itemStyle:{color:"#f56c6c",borderRadius:[4,4,0,0]}},{name:"优化后",type:"bar",data:o.map(l=>+l.after_percent.toFixed(1)),itemStyle:{color:"#67c23a",borderRadius:[4,4,0,0]}}]}}),S=async()=>{try{const o=await v.getSystemInfo();b.value=o.mem_total,w.value=o.mem_used,B.value=o.mem_percent}catch{}},F=async()=>{try{const o=await v.getMemOptStats();Object.assign(n,o)}catch{}},R=async()=>{x.value=!0;try{m.value=await v.optimizeMemory(),z.success(`释放了 ${m.value.freed_mb.toFixed(1)} MB 内存`),await S(),await F()}catch{z.error("内存优化失败")}finally{x.value=!1}};return H(()=>{S(),F()}),(o,t)=>{const l=r("el-progress"),u=r("Cpu"),E=r("el-icon"),L=r("el-button"),i=r("el-card"),p=r("el-col"),N=r("el-result"),T=r("el-alert"),g=r("el-row");return h(),J("div",Z,[t[14]||(t[14]=a("h2",{style:{"margin-bottom":"20px",color:"#303133"}},"内存优化",-1)),s(g,{gutter:16},{default:e(()=>[s(p,{span:8},{default:e(()=>[s(i,{shadow:"hover",class:"mem-card"},{header:e(()=>[...t[0]||(t[0]=[a("span",null,"当前内存状态",-1)])]),default:e(()=>[s(l,{type:"dashboard",percentage:Math.round(B.value),width:160,color:C},null,8,["percentage"]),a("p",tt,d(M(w.value))+" / "+d(M(b.value)),1),s(L,{type:"primary",size:"large",loading:x.value,style:{"margin-top":"12px"},onClick:R},{default:e(()=>[s(E,null,{default:e(()=>[s(u)]),_:1}),t[1]||(t[1]=W(" 一键优化 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1}),s(p,{span:8},{default:e(()=>[m.value?(h(),A(i,{key:0,shadow:"hover",class:"mem-card"},{header:e(()=>[...t[2]||(t[2]=[a("span",null,"本次优化结果",-1)])]),default:e(()=>[s(N,{icon:"success",title:`释放 ${m.value.freed_mb.toFixed(1)} MB`},{"sub-title":e(()=>[a("p",null,"优化前: "+d(m.value.before_percent.toFixed(1))+"%",1),a("p",null,"优化后: "+d(m.value.after_percent.toFixed(1))+"%",1)]),_:1},8,["title"])]),_:1})):(h(),A(i,{key:1,shadow:"hover",class:"mem-card"},{header:e(()=>[...t[3]||(t[3]=[a("span",null,"优化说明",-1)])]),default:e(()=>[s(T,{type:"info",closable:!1,"show-icon":""},{default:e(()=>[...t[4]||(t[4]=[a("p",null,"内存优化会收缩所有进程的工作集，将暂时不用的内存页释放回系统。",-1),a("p",{style:{"margin-top":"8px"}},"不会关闭任何程序，可临时释放物理内存。",-1)])]),_:1})]),_:1}))]),_:1}),s(p,{span:8},{default:e(()=>[s(i,{shadow:"hover",class:"mem-card stat-overview"},{header:e(()=>[...t[5]||(t[5]=[a("span",null,"优化统计",-1)])]),default:e(()=>[a("div",et,[a("div",ot,[a("div",at,d(n.total_count),1),t[6]||(t[6]=a("div",{class:"stat-desc"},"累计优化次数",-1))]),a("div",st,[a("div",lt,d(n.total_freed_mb.toFixed(0))+" MB",1),t[7]||(t[7]=a("div",{class:"stat-desc"},"累计释放内存",-1))]),a("div",nt,[a("div",rt,d(n.last_opt_ago||"暂无"),1),t[8]||(t[8]=a("div",{class:"stat-desc"},"距上次优化",-1))]),a("div",it,[a("div",dt,d(n.last_opt_time||"-"),1),t[9]||(t[9]=a("div",{class:"stat-desc"},"上次优化时间",-1))])])]),_:1})]),_:1})]),_:1}),s(g,{gutter:16,style:{"margin-top":"16px"}},{default:e(()=>[s(p,{span:14},{default:e(()=>[s(i,{shadow:"hover"},{header:e(()=>[...t[10]||(t[10]=[a("span",null,"最近优化趋势",-1)])]),default:e(()=>[s(f(_),{option:$.value,style:{height:"300px"},autoresize:""},null,8,["option"])]),_:1})]),_:1}),s(p,{span:10},{default:e(()=>[s(i,{shadow:"hover"},{header:e(()=>[...t[11]||(t[11]=[a("span",null,"每日释放量（近 30 天）",-1)])]),default:e(()=>[s(f(_),{option:k.value,style:{height:"300px"},autoresize:""},null,8,["option"])]),_:1})]),_:1})]),_:1}),s(g,{gutter:16,style:{"margin-top":"16px"}},{default:e(()=>[s(p,{span:14},{default:e(()=>[s(i,{shadow:"hover"},{header:e(()=>[...t[12]||(t[12]=[a("span",null,"月度优化统计",-1)])]),default:e(()=>[s(f(_),{option:I.value,style:{height:"280px"},autoresize:""},null,8,["option"])]),_:1})]),_:1}),s(p,{span:10},{default:e(()=>[s(i,{shadow:"hover"},{header:e(()=>[...t[13]||(t[13]=[a("span",null,"最近优化前后对比",-1)])]),default:e(()=>[s(f(_),{option:O.value,style:{height:"280px"},autoresize:""},null,8,["option"])]),_:1})]),_:1})]),_:1})])}}}),yt=Y(pt,[["__scopeId","data-v-6177b998"]]);export{yt as default};
