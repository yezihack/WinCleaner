import{d as Y,o as Z,c as N,a as s,b as a,w as l,n as w,m as J,r as p,e as k,f as o,h as v,u as E,s as T,l as m,t as n,g as ee,p as F,E as B,q as te}from"./index-CeN3S9B-.js";import{u as ae,s as le,i as se,a as oe,b as ne,c as ie,d as re,e as ce}from"./index-DWTZmJt_.js";import{i as de}from"./install-BKa6yPLF.js";import{i as ue}from"./install-A2hVvJB5.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe={class:"cleaner"},me={class:"action-bar"},fe={class:"expand-files"},ve={class:"expand-header"},ye={class:"file-path"},he={class:"category-name"},ge={class:"history-header"},xe={key:0,class:"history-section"},be={class:"stat-card"},we={class:"stat-value"},ke={class:"stat-card"},Be={class:"stat-value"},Ce={class:"stat-card"},$e={class:"stat-value"},Me=Y({__name:"Cleaner",setup(ze){ae([se,de,oe,ne,ie,re,ue,ce]);const b=p(!1),C=p(!1),y=p([]),$=p([]),f=p(null),M=ee({}),d=p(null),z=p("daily"),V=F(()=>$.value.map(t=>t.category)),U=F(()=>$.value.reduce((t,e)=>t+e.size,0)),H=t=>{const e=(M[t.category]||"").toLowerCase();return e?t.items.filter(u=>u.path.toLowerCase().includes(e)):t.items},h=t=>{if(!t||t===0)return"0 B";const e=1024,u=["B","KB","MB","GB","TB"],_=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,_)).toFixed(1))+" "+u[_]},q=t=>+(t/1024/1024).toFixed(1),G=F(()=>{if(!d.value)return{};const t=z.value==="daily",e=t?d.value.daily_stats||[]:d.value.monthly_stats||[],u=e.map(i=>t?i.date:i.month),_=e.map(i=>q(i.freed_size)),D=e.map(i=>i.count);return{tooltip:{trigger:"axis",formatter:i=>{const r=i[0],g=i[1];return`${r.axisValue}<br/>
          ${r.marker} 释放: ${r.value} MB<br/>
          ${g.marker} 文件数: ${g.value}`}},legend:{data:["释放空间 (MB)","清理文件数"]},grid:{left:50,right:50,bottom:40,top:40},xAxis:{type:"category",data:u,axisLabel:{rotate:t?45:0,fontSize:11}},yAxis:[{type:"value",name:"MB",position:"left"},{type:"value",name:"文件数",position:"right"}],series:[{name:"释放空间 (MB)",type:"bar",data:_,itemStyle:{color:"#409eff",borderRadius:[4,4,0,0]},yAxisIndex:0},{name:"清理文件数",type:"line",data:D,itemStyle:{color:"#67c23a"},smooth:!0,yAxisIndex:1}]}}),K=async()=>{b.value=!0,f.value=null;try{y.value=await k.scanJunk(),B.success(`扫描完成，发现 ${y.value.length} 个分类`)}catch{B.error("扫描失败")}finally{b.value=!1}},O=async()=>{try{await te.confirm(`确定清理选中的 ${V.value.length} 个分类？`,"确认清理",{type:"warning"})}catch{return}C.value=!0;try{f.value=await k.cleanJunk(V.value),B.success("清理完成"),y.value=await k.scanJunk(),await S()}catch{B.error("清理失败")}finally{C.value=!1}},j=t=>{$.value=t},S=async()=>{try{const t=await k.getCleanHistory();t&&(t.total_count>0||t.records&&t.records.length>0)?d.value=t:d.value=null}catch{d.value=null}};return Z(()=>{S()}),(t,e)=>{const u=o("el-icon"),_=o("el-button"),D=o("Delete"),i=o("el-input"),r=o("el-table-column"),g=o("el-table"),I=o("el-empty"),R=o("el-card"),P=o("el-result"),Q=o("Refresh"),A=o("el-col"),W=o("el-row"),L=o("el-radio-button"),X=o("el-radio-group");return v(),N("div",pe,[e[9]||(e[9]=s("h2",{style:{"margin-bottom":"20px",color:"#303133"}},"垃圾清理",-1)),a(R,{shadow:"hover"},{default:l(()=>[s("div",me,[a(_,{type:"primary",loading:b.value,onClick:K},{default:l(()=>[a(u,null,{default:l(()=>[a(E(T))]),_:1}),e[1]||(e[1]=m(" 扫描垃圾 ",-1))]),_:1},8,["loading"]),a(_,{type:"danger",loading:C.value,disabled:V.value.length===0,onClick:O},{default:l(()=>[a(u,null,{default:l(()=>[a(D)]),_:1}),m(" 清理选中 ("+n(h(U.value))+") ",1)]),_:1},8,["loading","disabled"])]),y.value.length>0?(v(),w(g,{key:0,data:y.value,style:{"margin-top":"16px"},"row-key":"category",onSelectionChange:j},{default:l(()=>[a(r,{type:"expand"},{default:l(({row:c})=>[s("div",fe,[s("div",ve,[s("span",null,n(c.category)+" - 共 "+n(c.count)+" 个文件",1),a(i,{modelValue:M[c.category],"onUpdate:modelValue":x=>M[c.category]=x,placeholder:"搜索文件名...",clearable:"",size:"small",style:{width:"240px"},"prefix-icon":E(T)},null,8,["modelValue","onUpdate:modelValue","prefix-icon"])]),a(g,{data:H(c),size:"small","max-height":"360",stripe:""},{default:l(()=>[a(r,{label:"文件路径","min-width":"400"},{default:l(({row:x})=>[s("span",ye,n(x.path),1)]),_:1}),a(r,{label:"大小",width:"100",align:"right"},{default:l(({row:x})=>[m(n(h(x.size)),1)]),_:1})]),_:1},8,["data"])])]),_:1}),a(r,{type:"selection",width:"50"}),a(r,{label:"分类"},{default:l(({row:c})=>[s("span",he,n(c.category),1)]),_:1}),a(r,{prop:"count",label:"文件数",width:"100"}),a(r,{label:"大小",width:"120"},{default:l(({row:c})=>[m(n(h(c.size)),1)]),_:1})]),_:1},8,["data"])):b.value?J("",!0):(v(),w(I,{key:1,description:"点击扫描开始检测垃圾文件"}))]),_:1}),f.value?(v(),w(R,{key:0,shadow:"hover",style:{"margin-top":"16px"}},{header:l(()=>[...e[2]||(e[2]=[s("span",null,"清理结果",-1)])]),default:l(()=>[a(P,{icon:"success",title:`释放空间: ${h(f.value.freed_size)}`},{"sub-title":l(()=>[m(" 成功清理 "+n(f.value.cleaned_count)+" 个文件， "+n(f.value.failed_count)+" 个跳过（无权限） ",1)]),_:1},8,["title"])]),_:1})):J("",!0),a(R,{shadow:"hover",style:{"margin-top":"16px"}},{header:l(()=>[s("div",ge,[e[3]||(e[3]=s("span",null,"清理历史",-1)),a(_,{text:"",size:"small",onClick:S},{default:l(()=>[a(u,null,{default:l(()=>[a(Q)]),_:1})]),_:1})])]),default:l(()=>[d.value?(v(),N("div",xe,[a(W,{gutter:16,class:"stat-cards"},{default:l(()=>[a(A,{span:8},{default:l(()=>[s("div",be,[s("div",we,n(d.value.last_clean_ago||"从未清理"),1),e[4]||(e[4]=s("div",{class:"stat-label"},"距上次清理",-1))])]),_:1}),a(A,{span:8},{default:l(()=>[s("div",ke,[s("div",Be,n(h(d.value.total_freed)),1),e[5]||(e[5]=s("div",{class:"stat-label"},"累计释放空间",-1))])]),_:1}),a(A,{span:8},{default:l(()=>[s("div",Ce,[s("div",$e,n(d.value.total_count),1),e[6]||(e[6]=s("div",{class:"stat-label"},"累计清理文件数",-1))])]),_:1})]),_:1}),a(X,{modelValue:z.value,"onUpdate:modelValue":e[0]||(e[0]=c=>z.value=c),style:{margin:"16px 0"}},{default:l(()=>[a(L,{value:"daily"},{default:l(()=>[...e[7]||(e[7]=[m("近30天",-1)])]),_:1}),a(L,{value:"monthly"},{default:l(()=>[...e[8]||(e[8]=[m("按月统计",-1)])]),_:1})]),_:1},8,["modelValue"]),a(E(le),{option:G.value,style:{height:"300px"},autoresize:""},null,8,["option"])])):(v(),w(I,{key:1,description:"暂无清理记录","image-size":60}))]),_:1})])}}}),Ee=_e(Me,[["__scopeId","data-v-1dfcfbc5"]]);export{Ee as default};
